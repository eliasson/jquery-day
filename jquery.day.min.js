(function(e){function t(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);for(var n=0;n<t.length;n++){var r=new RegExp("\\{"+n+"\\}","gi");e=e.replace(r,t[n])}return e}e.fn.day=function(t){return e.fn.day.month_names=["January","February","March","April","May","June","July","August","September","October","November","December"],e.fn.day.weekday_names=["MO","TU","WE","TH","FR","SA","SU"],this.each(function(){var n=e(this),r=n.data("daydata");if(!r){var i=new Date;r={current_date:new Date,current_year:i.getFullYear(),current_month:i.getMonth(),visible:!1},n.data("daydata",r)}e(this).click(function(i){e.fn.day.picker!==undefined&&e(e.fn.day.picker).fadeOut("fast",function(){e(e.fn.day.picker).remove(),visible=!1}),i.stopPropagation(),e.fn.day.picker=build_picker_markup(n,r,t),e.fn.day.picker.click(function(e){e.stopPropagation()}),e("html").click(function(){e(e.fn.day.picker).fadeOut("fast",function(){e(e.fn.day.picker).remove(),r.visible=!1})})})})},is_leap=function(e){return e%4===0&&e%100!==0||e%400===0},days_in_month=function(e,t){if(t===1)return is_leap(e)?29:28;var n=[31,28,31,30,31,30,31,31,30,31,30,31];return n[t]},build_picker_markup=function(n,r,i){var s='<div class="popup_day_selector"><table><thead><tr class="day_header"><td><a href="#" class="date_prev">&lt;</a></td>',o='<th colspan="5" class="day_month">{0}</th>',u='<td><a href="#" class="date_next">&gt;</a></td></tr><tr>',a="<th>{0}</th>",f="</tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>",l="</tbody></table></div>",c=e.fn.day.month_names[r.current_month]+" "+r.current_year;picker_code=s+t(o,c)+u;for(var h=0;h<e.fn.day.weekday_names.length;h++)picker_code+=t(a,e.fn.day.weekday_names[h]);picker_code+=f+l,e(n).after(picker_code);var p=e(n).siblings(".popup_day_selector");return update_picker(p,r,i),r.visible=!0,p.find("a.date_prev").click(function(){r.current_month>0?r.current_month--:(r.current_month=11,r.current_year--),r.current_date=new Date(r.current_year,r.current_month,1),update_picker(p,r,i)}),p.find("a.date_next").click(function(){r.current_month<11?r.current_month++:(r.current_month=0,r.current_year++),r.current_date=new Date(r.current_year,r.current_month,1),update_picker(p,r,i)}),n.data("daydata",r),p},update_picker=function(n,r,i){var s=new Date(r.current_date.getFullYear(),r.current_date.getMonth(),1),o=n.find("th.day_month");o.html(e.fn.day.month_names[r.current_month]+" "+r.current_year);var u=s.getDay()-1;u===-1&&(u=6);var a=days_in_month(r.current_year,r.current_month),f=days_in_month(s.getMonth()?s.getFullYear():s.getFullYear()-1,s.getMonth()?s.getMonth()-1:s.getMonth()),l=u,c=[];for(var h=l;h>0;h--)c.push(f-h+1);for(var h=0;h<a;h++)c.push(h+1);var p=0;while(c.length%7!=0)c.push(++p);var d=n.find("tbody");d.empty(),d.append("<tr></tr>");for(var h=0;h<c.length;h++){h%7===0&&h<c.length&&d.append("<tr></tr>");var v="";if(h<l||h>=a+l)v="date_off";var m=d.find("tr:last").append(t('<td class="{0}">{1}</td>',v,c[h])).find("td:last");m.click(function(){var t=e(this).text();e(this).hasClass("date_off")&&(parseInt(t)>15?r.current_month>0?r.current_month--:(r.current_month=11,r.current_year--):r.current_month<11?r.current_month++:(r.current_month=0,r.current_year++),r.current_date=new Date(r.current_year,r.current_month,1));var n=new Date(r.current_date.getFullYear(),r.current_date.getMonth(),t);e(e.fn.day.picker).fadeOut("fast",function(){e(e.fn.day.picker).remove(),r.visible=!1,i(n)})})}}})(jQuery);